# Архитектура блока перевода и утверждения глоссария

## 1. Архитектура системы

### 1.1. Общая структура

Блок перевода и утверждения глоссария является центральным компонентом системы машинного перевода, обеспечивающим терминологическую консистентность всего перевода. Архитектурно он состоит из следующих компонентов:

1. Модуль анализа и классификации терминов
2. Модуль генерации переводов терминов
3. Подсистема представления глоссария пользователю
4. Модуль обработки пользовательского выбора
5. Система маркировки и классификации терминов
6. Хранилище утвержденного глоссария

### 1.2. Интеграционные аспекты

Блок перевода и утверждения глоссария тесно интегрируется с другими компонентами системы:

1. Получает данные от блоков выделения терминов и предварительной обработки через стандартизированный JSON API с асинхронным обменом сообщениями
2. Передает утвержденный глоссарий в модуль машинного перевода через API с возможностью инкрементальных обновлений
3. Обеспечивает обратную связь для обучения и улучшения системы через механизм сборщика информации об утверждении терминов
4. Интегрируется с пользовательским интерфейсом через WebSocket для обеспечения реактивного взаимодействия
5. Предоставляет публичный API для интеграции с внешними системами, включая поддержку аутентификации и авторизации
6. Имплементирует механизм событий (Event Sourcing) для надежной синхронизации между компонентами
7. Интегрируется с системой управления внутренними глоссариями для обогащения терминологической базы на основе утвержденных пользователем переводов

### 1.3. Интерфейсы и зависимости модуля

- **Выходные интерфейсы модуля**:
    - `TranslatedGlossaryAPI`: Предоставляет доступ к переведенному и утвержденному глоссарию
        - Методы: `getTranslatedTerms()`, `getApprovedTerms()`, `getTermTranslationHistory(termId)`
        - Формат данных: Структурированные терминологические пары с метаданными и статусами
    - `GlossaryEventsAPI`: Система событий для оповещения о изменениях в глоссарии
        - События: `termTranslated`, `termApproved`, `termRejected`, `glossaryUpdated`
- **Входные зависимости**:
    - `ExtractedTerminologyAPI`: Получение извлеченных терминов (от модуля извлечения)
        - Требуемые методы: `getTerms()`, `getTermContexts(termId)`
    - `ProcessedUserResourcesAPI`: Доступ к пользовательским глоссариям
        - Требуемые методы: `getGlossary()`, `getTerminologyPreferences()`
    - `TranslationEngineAPI`: Интерфейс для автоматического перевода терминов
        - Требуемые методы: `translateTerm(term, context)`, `getTranslationAlternatives(term)`
- **Механизмы взаимодействия**:
    - REST API для синхронных запросов с поддержкой версионирования
    - WebSocket для real-time обновлений при коллективной работе
    - Система кэширования для оптимизации частых запросов с использованием Redis

## 2. Этапы обработки

### 2.1. Процесс анализа и классификации терминов

1. Первичное разделение терминов на известные и новые
2. Семантическая кластеризация и классификация по тематикам
3. Анализ контекстуального использования и определение приоритетов
4. Подготовка метаданных и статистики использования

### 2.2. Процесс генерации переводов

1. Извлечение существующих переводов из TM и пользовательского глоссария
2. Применение многоуровневой стратегии перевода для новых терминов
3. Обогащение вариантов перевода метаданными о степени доверия
4. Предварительная маркировка терминов и ранжирование вариантов перевода

### 2.3. Процесс представления и взаимодействия с пользователем

1. Формирование таблицы с оригинальными терминами и предлагаемыми переводами
2. Визуальное различение терминов через цветовую маркировку
3. Обеспечение интерактивного взаимодействия через контекстные меню и выпадающие списки
4. Поддержка механизмов поиска, фильтрации и массового утверждения

### 2.4. Процесс обработки пользовательского выбора

1. Сохранение выбранных и новых вариантов перевода
2. Обновление метаданных и управление версиями
3. Передача информации в модуль обучения и генерация обучающих датасетов
4. Контроль доступа при многопользовательской работе

### 2.5. Процесс сохранения и экспорта утвержденного глоссария

1. Структурированное сохранение глоссария и метаданных
2. Версионирование для разных проектов и документов
3. Экспорт в стандартные форматы и предоставление API доступа
4. Инкрементальное обновление и кэширование для производительности

### 2.6. Процесс обогащения внутренних глоссариев

1. Анализ утвержденных пользователем терминов после выгрузки документа
2. Фильтрация и отбор высококачественных терминологических пар
3. Интеграция отобранных терминов во внутренние глоссарии системы
4. Установление связей с метаданными о домене, контексте и уровне доверия

## 3. Модули проекта

### 3.1. Модуль анализа и классификации терминов

Этот модуль отвечает за предварительную обработку выделенных терминов:

1. Разделяет термины на уже имеющие перевод (из TM или пользовательского глоссария) и новые термины, требующие перевода
2. Классифицирует термины по тематикам с использованием специализированных BERT-классификаторов, обученных на доменных данных
3. Применяет семантическую кластеризацию терминов с использованием Sentence-BERT и FAISS для выявления семантически близких групп
4. Определяет контекстуальное использование термина на основе анализа сегментов текста
5. Устанавливает приоритеты терминов на основе частоты использования и важности в контексте документа
6. Подготавливает метаданные для каждого термина, включая статистику использования и контекстуальные примеры
7. Реализует эвристический анализ для обработки сложных многословных терминов и определения их границ

### 3.2. Модуль генерации переводов терминов

Данный модуль отвечает за создание вариантов перевода для терминов:

1. Извлекает существующие переводы из TM и пользовательского глоссария через REST API с использованием асинхронных запросов. Также извлекает существующие переводы из внутренних глоссариев системы, сформированных на основе предыдущих переводов пользователей
2. Для новых терминов применяет несколько стратегий перевода:
    - Использует специализированные терминологические модели перевода с учетом тематики
    - Анализирует контекст использования термина
    - Учитывает правила стайлгайда при генерации вариантов
    - Генерирует множество вариантов перевода (до 5) с ранжированием на основе контекстных эмбеддингов
3. Обогащает каждый вариант перевода метаданными о степени доверия, используя:
    - Вероятностные оценки модели перевода
    - Частоту использования в доменных глоссариях
    - Близость к существующим переводам из TM по косинусному сходству векторных представлений
    - Соответствие правилам стайлгайда
4. Присваивает предварительную маркировку (розовую для существующих, зеленую для новых терминов)
5. Сохраняет промежуточные результаты для инкрементальной обработки при повторном анализе документа

### 3.3. Подсистема представления глоссария пользователю

Этот компонент отвечает за пользовательский интерфейс представления глоссария:

1. Формирует двухколоночную таблицу с оригинальными терминами и предлагаемыми переводами
2. Обеспечивает визуальное различие между существующими и новыми терминами через цветовую маркировку
3. Реализует интерактивные элементы:
    - Всплывающие окна с контекстом при нажатии на оригинальный термин
    - Выпадающие списки с альтернативными вариантами перевода при нажатии на переведенный термин
    - Асинхронную загрузку контекстуальных примеров для снижения нагрузки на интерфейс
4. Обеспечивает сортировку и фильтрацию терминов по различным критериям
5. Предоставляет возможность массового утверждения терминов для ускорения работы пользователя
6. Реализует поиск по терминам с автодополнением и подсветкой найденных фрагментов
7. Поддерживает механизм правил утверждения для автоматического принятия терминов с высокой степенью уверенности или повторяющихся терминов
8. Включает инструменты визуализации семантических групп терминов для облегчения контроля консистентности

### 3.4. Модуль обработки пользовательского выбора

Данный модуль отвечает за обработку решений пользователя:

1. Сохраняет выбранные пользователем варианты перевода
2. Регистрирует новые варианты, введенные пользователем вручную
3. Обновляет метаданные терминов на основе выбора пользователя
4. Отслеживает и сохраняет историю изменений для возможного отката
5. Внедряет многоуровневую систему управления версиями с возможностью возврата к предыдущим утверждениям
6. Передает информацию о выборе пользователя в модуль обучения для повышения качества будущих переводов:
    - Генерирует датасеты для дообучения BERT-моделей с примерами контекстуального использования терминов
    - Обновляет статистические веса для ранжирования вариантов перевода
    - Пополняет базу знаний для доменной адаптации моделей перевода
7. При многопользовательском доступе обеспечивает разграничение прав для утверждения терминов на основе ролевой модели

### 3.5. Система маркировки и классификации терминов

Этот компонент обеспечивает надежную систему маркировки терминов:

1. Присваивает розовую маркировку терминам, извлеченным из TM или пользовательского глоссария
2. Присваивает зеленую маркировку для вновь переведенных терминов
3. Обеспечивает сохранение маркировки при экспорте глоссария
4. Ведет учет происхождения и истории изменений каждого термина
5. Обновляет маркировку при изменении статуса термина
6. Поддерживает механизм тегирования терминов дополнительными атрибутами (например, "высокая уверенность", "требует проверки", "утверждено экспертом")

### 3.6. Хранилище утвержденного глоссария

Финальный компонент архитектуры:

1. Сохраняет утвержденный пользователем глоссарий в структурированном формате
2. Реализует двухуровневую систему хранения:
    - PostgreSQL с JSONB полями для гибкого хранения атрибутов терминов и их версий
    - Redis для кэширования часто используемых терминов с автоматической инвалидацией при обновлении
3. Обеспечивает быстрый доступ к глоссарию для последующих этапов перевода
4. Включает все метаданные и маркировку терминов
5. Поддерживает версионность глоссария для разных проектов и документов
6. Обеспечивает экспорт глоссария в стандартные форматы для использования в других инструментах
7. Предоставляет REST API для динамического обновления и доступа к глоссарию в процессе перевода
8. Синхронизируется с системой внутренних глоссариев, обеспечивая двунаправленный обмен терминологическими данными

### 3.7. Модуль выходных данных

Этот модуль отвечает за подготовку и структурирование выходных данных блока перевода и утверждения глоссария:

1. Формирует унифицированный формат глоссария для последующих этапов машинного перевода:
    
    - Сериализует термины и их переводы в стандартизированный JSON-формат
    - Обеспечивает сохранение связи между термином и его контекстом
    - Включает метаданные о степени уверенности и происхождении термина
2. Создает структурированное представление утвержденного глоссария с цветовой маркировкой:
    
    - Розовая маркировка для терминов из TM или пользовательского глоссария
    - Зеленая маркировка для вновь переведенных терминов
    - Дополнительные метки статуса ("утверждено", "на рассмотрении", "автоматически принято")
3. Предоставляет интерфейсы экспорта в различные форматы:
    
    - TBX (TermBase eXchange) для специализированных CAT-систем
    - CSV/Excel для удобства работы с табличными данными
    - JSON для интеграции с API других систем
    - HTML для визуализации и просмотра в браузере
4. Поддерживает инкрементальные обновления выходных данных:
    
    - Отслеживает изменения в глоссарии с момента последнего экспорта
    - Формирует дельта-пакеты для оптимизации передачи данных
    - Обеспечивает атомарность операций обновления
5. Реализует механизмы валидации выходных данных:
    
    - Проверяет консистентность терминологии
    - Выявляет потенциальные конфликты и дубликаты
    - Генерирует отчеты о качестве глоссария и потенциальных проблемах
6. Включает аналитические данные о процессе перевода и утверждения:
    
    - Статистику об источниках терминов (TM, пользовательский глоссарий, новые переводы)
    - Метрики о скорости и эффективности работы с глоссарием
    - Информацию о проблемных терминах, требующих дополнительного внимания
7. Обеспечивает обратную связь с предыдущими этапами обработки:
    
    - Передает информацию о качестве извлечения терминов
    - Предоставляет данные для улучшения алгоритмов классификации
    - Формирует датасеты для дообучения моделей машинного перевода

### 3.8. Модуль управления внутренними глоссариями

Добавить новый подраздел:

1. Этот модуль отвечает за обогащение и поддержку внутренних глоссариев системы:
    - Обрабатывает утвержденные пользователем термины после выгрузки документа
    - Применяет алгоритмы фильтрации для выделения качественных терминологических пар
    - Оценивает степень универсальности термина для потенциального использования в других переводах
    - Классифицирует термины по доменам и тематикам
2. Реализует механизмы оценки качества терминов для включения во внутренние глоссарии:
    - Анализирует последовательность действий пользователя при выборе перевода
    - Оценивает уровень "вручную отредактированных" терминов выше чем "автоматически принятых"
    - Учитывает частоту использования терминов в различных проектах перевода
3. Поддерживает многоуровневую систему внутренних глоссариев:
    - Глобальный глоссарий для общеупотребительных терминов
    - Доменные глоссарии для специфических тематик
    - Пользовательские глоссарии, привязанные к конкретным проектам или пользователям
    - Временные глоссарии для экспериментальных или непроверенных терминов
4. Обеспечивает приоритизацию терминов при использовании:
    - Создает рейтинговую систему для разрешения конфликтов при наличии нескольких вариантов перевода
    - Адаптирует приоритеты в зависимости от текущего контекста перевода
    - Поддерживает механизм обратной связи для корректировки рейтингов на основе выборов пользователя
5. Предоставляет API для доступа к внутренним глоссариям:
    - Обеспечивает быстрый поиск по терминам с учетом контекста и домена
    - Поддерживает пакетные запросы для оптимизации производительности
    - Реализует механизмы кэширования для часто используемых терминов
6. Реализует систему мониторинга качества внутренних глоссариев:
    - Отслеживает статистику использования и принятия терминов
    - Выявляет потенциально устаревшие или неточные термины
    - Формирует рекомендации по обновлению терминологической базы
7. Обеспечивает экспорт и импорт внутренних глоссариев для обмена между разными инсталляциями системы

## 4. Технологический стек

### 4.1. Базовые технологии

1. **Языки программирования**: Python 3.8+ для бэкенда, TypeScript для фронтенда
2. **Фреймворки**: FastAPI для API-сервисов, React для пользовательского интерфейса
3. **Контейнеризация**: Docker и Docker Compose для изоляции и управления компонентами
4. **Оркестрация**: Kubernetes для управления контейнерами в продакшн-среде

### 4.2. Хранение данных

1. **База данных**: PostgreSQL 13+ с расширением JSONB для гибкого хранения, с дополнительной схемой для поддержки внутренних глоссариев системы
2. **Кэширование**: Redis для быстрого доступа к часто используемым данным
3. **Очереди сообщений**: RabbitMQ для асинхронной обработки и обмена сообщениями
4. **Управление версиями**: Git-подобная система отслеживания изменений глоссария

### 4.3. Обработка и анализ

1. **ML-фреймворки**: PyTorch для моделей машинного обучения, Hugging Face Transformers для работы с BERT
2. **Векторные операции**: FAISS для эффективного поиска в пространстве эмбеддингов
3. **NLP-компоненты**: Sentence-BERT для создания векторных представлений, spaCy для лингвистического анализа
4. **Инструменты терминологии**: Терминологические базы TBX и TMX для обмена данными

### 4.4. Пользовательский интерфейс

1. **UI-фреймворк**: React с TypeScript для типобезопасной разработки
2. **Компонентная библиотека**: Material-UI или Ant Design для унифицированных компонентов
3. **Управление состоянием**: Redux или Context API для централизованного управления состоянием
4. **Взаимодействие в реальном времени**: WebSocket через Socket.io для реактивного интерфейса

### 4.5. Производительность и масштабируемость

1. **Параллельная обработка**: Celery для распределенных задач и асинхронной обработки
2. **Мониторинг**: Prometheus и Grafana для отслеживания производительности
3. **Инкрементальная обработка**: Механизмы отслеживания изменений и частичного обновления
4. **Кэширование на нескольких уровнях**:
    - Клиентское кэширование в браузере
    - Серверное кэширование с Redis
    - Кэширование запросов к базе данных
5. **Горизонтальное масштабирование**: Stateless-архитектура для возможности добавления серверов обработки